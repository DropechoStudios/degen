<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="degen.js"></script>
    <title></title>
</head>

<body>
  <div>
    <select id="generatorType">
      <option value="room">room</option>
      <option value="cave">cave</option>
    </select>
    <br/> 

    <label for="width">width</label>
    <input id="width" type="range" min="32" max="96"></input>
    <span id="widthVal"></span>
    <br/> 
    <label for="height">height</label>
    <input id="height" type="range" min="32" max="96"></input>
    <span id="heightVal"></span>
    <br/> 
    <div id='bspOptions'>
      <label for="minWidth">minWidth</label>
      <input id="minWidth" type="range" min="4" max="32"></input>
      <span id="minWidthVal"></span>
      <br/> 
      <label for="minHeight">minHeight</label>
      <input id="minHeight" type="range" min="4" max="32"></input>
      <span id="minHeightVal"></span>
      <br/> 
      <label for="depth">depth</label>
      <input id="depth" type="range" min="1" max="12"></input>
      <span id="depthVal"></span>
      <br/> 
      <label for="ratio">ratio</label>
      <input id="ratio" type="range" min="0" max="1" step=".01"></input>
      <span id="ratioVal"></span>
      <br/> 
      <label for="Padding">padding</label>
      <input id="paddingRatio" type="range" min="0" max="1" step=".01" value="0.25"></input>
      <span id="paddingRatioVal"></span>
      <br/> 
    </div>
    <div id='caveOptions' style="visibility:hidden">
      <label for="start_fill_percent">Start Fill Percent</label>
      <input id="start_fill_percent" type="range" min="0" max="100" value="35"></input>
      <span id="start_fill_percentVal"></span>
      <br/> 
    </div>

  </div>

  <div style="position:absolute; top: 0px; left: 400px;">
    <canvas id="canvas" height="1024" width="1024"></canvas>
  </div>
</body>
<script type="text/javascript">
  var bsp = new degen.BSPGenerator();
  var map = degen.RoomGenerator.buildRooms(bsp.generate());
  var ctx = document.querySelector('canvas').getContext('2d');
  var genType = 'room';
  var roomGenParams = {};
  var caveGenParams = {
    tile_floor: 1,
    tile_wall: 0,
    start_fill_percent: 35
  };

  var mapScale = 10;

  function rebuildAndDrawMap(){
    if(genType === 'cave'){
      map = degen.CAGenerator.generate(caveGenParams);
    } else {
      map = degen.RoomGenerator.buildRooms(bsp.generate(), roomGenParams);
    }
    ctx.clearRect(0,0,1024,1024);

    map._mapData.forEach(function(tile,i){
      var pos = map.IndexToXY(i);
      ctx.fillStyle = tile == 1 ? '#FFFFFF' : "#000000"; 
      ctx.fillRect(pos.x*mapScale,pos.y*mapScale,mapScale,mapScale);
    });
  }


  function setupSlider(id, obj){
    var slider = document.querySelector('#' + id);
    var valId = '#' + id + 'Val';

    obj[id] = +slider.value;
    document.querySelector(valId).innerHTML = +obj[id]; 

    slider.addEventListener('input',function(){
      document.querySelector(valId).innerHTML = obj[id] = +slider.value;
      rebuildAndDrawMap();
    });
  }

  var sliders = document.querySelectorAll('input');
  var paddingslider = document.querySelector('#paddingRatio');

  sliders.forEach(function(sl){
    setupSlider(sl.id, bsp);
    setupSlider(sl.id, caveGenParams);
  });

  setupSlider(paddingslider.id, roomGenParams);


  var typeMenu = document.querySelector('#generatorType');
  typeMenu.addEventListener('change', function(ev){
    genType = ev.target.value;
    if(genType === 'cave'){
      document.querySelector('#bspOptions').style.visibility = 'hidden';
      document.querySelector('#caveOptions').style.visibility = 'visible';
    } else {
      document.querySelector('#bspOptions').style.visibility = 'visible';
      document.querySelector('#caveOptions').style.visibility = 'hidden';
    }
    rebuildAndDrawMap();
  });


  rebuildAndDrawMap();
</script>

</html>
